# db

Package db provides database abstraction layer for ModulaCMS. Supports SQLite, MySQL, and PostgreSQL through a unified DbDriver interface. Each database backend implements the same interface with driver-specific types generated by sqlc.

## Overview

The db package uses a wrapper pattern where wrapper structs (defined in this package) abstract over sqlc-generated types from three driver packages: db-sqlite (mdb), db-mysql (mdbm), db-psql (mdbp). Each entity has mapper functions to convert between driver types and wrapper types.

Import aliases: `mdb` for SQLite, `mdbm` for MySQL, `mdbp` for PostgreSQL.

## Database Drivers

Three driver implementations provide identical interfaces with database-specific internals.

### Database

SQLite database connection. Represents a single SQLite file connection with embedded context.

Fields: `Src` (file path), `Status` (open/closed/error), `Connection` (sql.DB pointer), `LastConnection` (timestamp), `Err` (last error), `Config` (config.Config), `Context` (context.Context).

### MysqlDatabase

MySQL database connection. Represents a network connection to MySQL server with embedded context.

Fields: identical to Database structure with same semantics.

### PsqlDatabase

PostgreSQL database connection. Represents a network connection to PostgreSQL server with embedded context.

Fields: identical to Database structure with same semantics.

### DbStatus

Connection status enum. String type with predefined constants.

Constants: `Open`, `Closed`, `Err`.

## Core Interface

### DbDriver

Unified interface for all database operations across SQLite, MySQL, PostgreSQL. Provides connection management, table operations, and CRUD methods for all 26 ModulaCMS tables. Each method group handles a specific entity type with consistent naming patterns.

## Connection Methods

Methods for managing database connections and executing raw queries.

### CreateAllTables

Creates all 26 database tables in dependency order. Tier 0: permissions, roles, media_dimensions. Tier 1: users. Tier 2: tokens, oauth, ssh_keys, sessions, tables, media, routes, datatypes. Tier 3: fields. Tier 4: content_data. Tier 5: content_fields, content_relations. Tier 6: junction tables. Returns error if any table creation fails.

### CreateBootstrapData

Inserts required system records after CreateAllTables succeeds. Creates system admin user, default roles and permissions, home route, page datatype, validation records for all 26 tables. Accepts admin password hash. Returns error with specific table name if any bootstrap insert fails.

### ValidateBootstrapData

Verifies all tables contain expected bootstrap records. Checks record counts for all 26 tables. Validates tables registry has exactly 26 entries. Returns combined error listing all validation failures.

### DropAllTables

Drops all 26 database tables in reverse dependency order. Dangerous operation for testing or reinstallation. Returns error if any drop fails.

### DumpSql

Exports database to SQL file. Accepts config.Config for output path. Uses sqlite3 dump command for SQLite, mysqldump for MySQL, pg_dump for PostgreSQL. Returns error if dump command fails.

### ExecuteQuery

Executes raw SQL query on database. Accepts query string and DBTable for table name substitution. Returns sql.Rows cursor or error. Use for queries not covered by typed methods.

### GetConnection

Returns database connection and context. Returns sql.DB pointer, context.Context, and error. Used for transaction operations and custom queries.

### GetForeignKeys

Retrieves foreign key constraints for tables. Accepts slice of table names. Returns sql.Rows cursor. SQLite-specific for schema introspection.

### Ping

Checks if database connection is alive. Returns error if connection is nil or ping fails. Use for health checks and connection validation.

### Query

Executes SQL query with result. Accepts database connection and query string. Returns sql.Result with rows affected. Used for custom mutations.

### ScanForeignKeyQueryRows

Parses foreign key query results. Accepts sql.Rows from GetForeignKeys. Returns slice of SqliteForeignKeyQueryRow. SQLite-specific helper.

### SelectColumnFromTable

Queries single column from table. Accepts table name and column name. Returns selected values. Used for batch operations.

### SortTables

Determines table creation order based on foreign key dependencies. Returns error if circular dependencies detected. Used internally by CreateAllTables.

## Table Constants

### DBTable

String type representing table names. Used for type-safe table references.

Constants: `Admin_content_data`, `Admin_content_fields`, `Admin_datatype`, `Admin_datatype_fields`, `Admin_field`, `Admin_route`, `Content_data`, `Content_fields`, `Datatype_fields`, `Datatype`, `Field`, `MediaT`, `Media_dimension`, `Permission`, `Role`, `Route`, `Session`, `Table`, `Token`, `User`, `User_oauth`.

### TableStructMap

Maps DBTable constants to Go struct types. Keys are DBTable values, values are reflect.Type for corresponding wrapper structs. Used by query builder and generic operations.

### CastToTypedSlice

Casts generic slice to typed slice based on table. Accepts any value and DBTable constant. Returns typed slice or original value if cast fails. Used after parsing query results.

## AdminContentData Methods

CRUD operations for admin content data table. Admin content forms tree structures via parent_id, first_child_id, next_sibling_id, prev_sibling_id pointers.

### CountAdminContentData

Returns total count of admin content records. Returns pointer to int64 or error.

### CreateAdminContentData

Inserts new admin content record with audit context. Accepts context, audit context, and CreateAdminContentDataParams. Returns created AdminContentData pointer or error. Records change event for replication.

### CreateAdminContentDataTable

Creates admin_content_data table with schema. Returns error if creation fails.

### DeleteAdminContentData

Deletes admin content record by ID with audit trail. Accepts context, audit context, and admin content ID. Returns error if deletion fails. Records change event.

### GetAdminContentData

Retrieves single admin content record by ID. Accepts admin content ID. Returns AdminContentData pointer or error.

### ListAdminContentData

Retrieves all admin content records. Returns slice pointer or error. Not recommended for large datasets.

### ListAdminContentDataByRoute

Retrieves admin content for specific admin route. Accepts route slug string. Returns slice pointer or error. Filtered by admin_route_id foreign key.

### ListAdminContentDataPaginated

Retrieves admin content with pagination. Accepts PaginationParams with limit and offset. Returns slice pointer or error. Use for large datasets.

### ListAdminContentDataByRoutePaginated

Retrieves admin content by route with pagination. Accepts ListAdminContentDataByRoutePaginatedParams containing route filter and pagination. Returns slice pointer or error.

### UpdateAdminContentData

Updates admin content record with audit trail. Accepts context, audit context, and UpdateAdminContentDataParams. Returns updated ID string pointer or error. Records change event.

## AdminContentField Methods

CRUD operations for admin content field values. Each record stores one field value for one admin content node.

### CountAdminContentFields

Returns total count of admin content field records. Returns pointer to int64 or error.

### CreateAdminContentField

Inserts new admin content field value with audit context. Accepts context, audit context, and CreateAdminContentFieldParams. Returns created AdminContentFields pointer or error. Records change event.

### CreateAdminContentFieldTable

Creates admin_content_fields table with schema. Returns error if creation fails.

### DeleteAdminContentField

Deletes admin content field by ID with audit trail. Accepts context, audit context, and admin content field ID. Returns error if deletion fails. Records change event.

### GetAdminContentField

Retrieves single admin content field by ID. Accepts admin content field ID. Returns AdminContentFields pointer or error.

### ListAdminContentFields

Retrieves all admin content field records. Returns slice pointer or error. Not recommended for large datasets.

### ListAdminContentFieldsByRoute

Retrieves admin content fields for specific admin route. Accepts route slug string. Returns slice pointer or error.

### ListAdminContentFieldsPaginated

Retrieves admin content fields with pagination. Accepts PaginationParams. Returns slice pointer or error.

### ListAdminContentFieldsByRoutePaginated

Retrieves admin content fields by route with pagination. Accepts ListAdminContentFieldsByRoutePaginatedParams. Returns slice pointer or error.

### UpdateAdminContentField

Updates admin content field value with audit trail. Accepts context, audit context, and UpdateAdminContentFieldParams. Returns updated ID string pointer or error. Records change event.

## AdminContentRelation Methods

CRUD operations for admin content relations table. Links admin content nodes through relation fields with sort ordering.

### CountAdminContentRelations

Returns total count of admin content relation records. Returns pointer to int64 or error.

### CreateAdminContentRelation

Inserts new admin content relation with audit context. Accepts context, audit context, and CreateAdminContentRelationParams. Returns created AdminContentRelations pointer or error. Records change event.

### CreateAdminContentRelationTable

Creates admin_content_relations table with schema. Returns error if creation fails.

### DeleteAdminContentRelation

Deletes admin content relation by ID with audit trail. Accepts context, audit context, and admin content relation ID. Returns error if deletion fails. Records change event.

### DropAdminContentRelationTable

Drops admin_content_relations table. Dangerous operation for schema migrations. Returns error if drop fails.

### GetAdminContentRelation

Retrieves single admin content relation by ID. Accepts admin content relation ID. Returns AdminContentRelations pointer or error.

### ListAdminContentRelationsBySource

Retrieves relations where source matches given admin content ID. Accepts source admin content ID. Returns slice pointer or error. Use for finding all relations from a content node.

### ListAdminContentRelationsByTarget

Retrieves relations where target matches given admin content ID. Accepts target admin content ID. Returns slice pointer or error. Use for finding reverse relations.

### ListAdminContentRelationsBySourceAndField

Retrieves relations filtered by source content and field. Accepts source admin content ID and admin field ID. Returns slice pointer or error. Use for specific relation field queries.

### UpdateAdminContentRelationSortOrder

Updates sort order for relation. Accepts context, audit context, and UpdateAdminContentRelationSortOrderParams. Returns error if update fails. Records change event.

## AdminDatatype Methods

CRUD operations for admin datatypes table. Defines content types for admin panel with optional parent for hierarchies.

### CountAdminDatatypes

Returns total count of admin datatype records. Returns pointer to int64 or error.

### CreateAdminDatatype

Inserts new admin datatype with audit context. Accepts context, audit context, and CreateAdminDatatypeParams. Returns created AdminDatatypes pointer or error. Records change event.

### CreateAdminDatatypeTable

Creates admin_datatypes table with schema. Returns error if creation fails.

### DeleteAdminDatatype

Deletes admin datatype by ID with audit trail. Accepts context, audit context, and admin datatype ID. Returns error if deletion fails. Records change event.

### GetAdminDatatypeById

Retrieves single admin datatype by ID. Accepts admin datatype ID. Returns AdminDatatypes pointer or error.

### ListAdminDatatypes

Retrieves all admin datatype records. Returns slice pointer or error.

### ListAdminDatatypesPaginated

Retrieves admin datatypes with pagination. Accepts PaginationParams. Returns slice pointer or error.

### ListAdminDatatypeChildrenPaginated

Retrieves child admin datatypes with pagination. Accepts ListAdminDatatypeChildrenPaginatedParams containing parent filter. Returns slice pointer or error. Use for hierarchical datatype navigation.

### UpdateAdminDatatype

Updates admin datatype with audit trail. Accepts context, audit context, and UpdateAdminDatatypeParams. Returns updated ID string pointer or error. Records change event.

## AdminDatatypeField Methods

CRUD operations for admin datatype field junction table. Links admin datatypes to admin field definitions with sort ordering.

### CountAdminDatatypeFields

Returns total count of admin datatype field records. Returns pointer to int64 or error.

### CreateAdminDatatypeField

Inserts new admin datatype field link with audit context. Accepts context, audit context, and CreateAdminDatatypeFieldParams. Returns created AdminDatatypeFields pointer or error. Records change event.

### CreateAdminDatatypeFieldTable

Creates admin_datatypes_fields table with schema. Returns error if creation fails.

### DeleteAdminDatatypeField

Deletes admin datatype field link by composite ID with audit trail. Accepts context, audit context, and string ID. Returns error if deletion fails. Records change event.

### ListAdminDatatypeField

Retrieves all admin datatype field links. Returns slice pointer or error.

### ListAdminDatatypeFieldByDatatypeID

Retrieves field links for specific admin datatype. Accepts admin datatype ID. Returns slice pointer or error. Use to get all fields for a datatype.

### ListAdminDatatypeFieldByFieldID

Retrieves datatype links for specific admin field. Accepts admin field ID. Returns slice pointer or error. Use to find which datatypes use a field.

### ListAdminDatatypeFieldPaginated

Retrieves admin datatype field links with pagination. Accepts PaginationParams. Returns slice pointer or error.

### ListAdminDatatypeFieldByDatatypeIDPaginated

Retrieves field links by datatype with pagination. Accepts ListAdminDatatypeFieldByDatatypeIDPaginatedParams. Returns slice pointer or error.

### ListAdminDatatypeFieldByFieldIDPaginated

Retrieves datatype links by field with pagination. Accepts ListAdminDatatypeFieldByFieldIDPaginatedParams. Returns slice pointer or error.

### UpdateAdminDatatypeField

Updates admin datatype field link with audit trail. Accepts context, audit context, and UpdateAdminDatatypeFieldParams. Returns updated ID string pointer or error. Records change event.

## AdminField Methods

CRUD operations for admin field definitions. Defines field configurations for admin content with validation and UI config.

### CountAdminFields

Returns total count of admin field records. Returns pointer to int64 or error.

### CreateAdminField

Inserts new admin field with audit context. Accepts context, audit context, and CreateAdminFieldParams. Returns created AdminFields pointer or error. Records change event.

### CreateAdminFieldTable

Creates admin_fields table with schema. Returns error if creation fails.

### DeleteAdminField

Deletes admin field by ID with audit trail. Accepts context, audit context, and admin field ID. Returns error if deletion fails. Records change event.

### GetAdminField

Retrieves single admin field by ID. Accepts admin field ID. Returns AdminFields pointer or error.

### ListAdminFields

Retrieves all admin field records. Returns slice pointer or error.

### ListAdminFieldsPaginated

Retrieves admin fields with pagination. Accepts PaginationParams. Returns slice pointer or error.

### ListAdminFieldsByParentIDPaginated

Retrieves child admin fields with pagination. Accepts ListAdminFieldsByParentIDPaginatedParams containing parent filter. Returns slice pointer or error. Use for nested field structures.

### UpdateAdminField

Updates admin field with audit trail. Accepts context, audit context, and UpdateAdminFieldParams. Returns updated ID string pointer or error. Records change event.

## AdminRoute Methods

CRUD operations for admin routes table. Defines URL routes for admin panel content trees.

### CountAdminRoutes

Returns total count of admin route records. Returns pointer to int64 or error.

### CreateAdminRoute

Inserts new admin route with audit context. Accepts context, audit context, and CreateAdminRouteParams. Returns created AdminRoutes pointer or error. Records change event.

### CreateAdminRouteTable

Creates admin_routes table with schema. Returns error if creation fails.

### DeleteAdminRoute

Deletes admin route by ID with audit trail. Accepts context, audit context, and admin route ID. Returns error if deletion fails. Records change event.

### GetAdminRoute

Retrieves single admin route by slug. Accepts slug. Returns AdminRoutes pointer or error.

### ListAdminRoutes

Retrieves all admin route records. Returns slice pointer or error.

### ListAdminRoutesPaginated

Retrieves admin routes with pagination. Accepts PaginationParams. Returns slice pointer or error.

### UpdateAdminRoute

Updates admin route with audit trail. Accepts context, audit context, and UpdateAdminRouteParams. Returns updated ID string pointer or error. Records change event.

## Backup Methods

CRUD operations for backups table. Tracks database backup files stored on S3-compatible storage.

### CountBackups

Returns total count of backup records. Returns pointer to int64 or error.

### CreateBackup

Inserts new backup record. Accepts CreateBackupParams. Returns created Backup pointer or error. Does not perform actual backup operation.

### CreateBackupTables

Creates all backup-related tables: backups, backup_sets, backup_verifications. Returns error if any creation fails.

### DeleteBackup

Deletes backup record by ID. Accepts backup ID. Returns error if deletion fails. Does not delete backup file from storage.

### DropBackupTables

Drops all backup-related tables. Dangerous operation for schema migrations. Returns error if any drop fails.

### GetBackup

Retrieves single backup by ID. Accepts backup ID. Returns Backup pointer or error.

### GetLatestBackup

Retrieves most recent backup for node. Accepts node ID. Returns Backup pointer or error. Ordered by creation timestamp descending.

### ListBackups

Retrieves backups with filters. Accepts ListBackupsParams for node filter, status filter, type filter. Returns slice pointer or error.

### UpdateBackupStatus

Updates backup status and completion time. Accepts UpdateBackupStatusParams. Returns error if update fails. Use to mark backup as completed or failed.

## BackupSet Methods

CRUD operations for backup_sets table. Represents collections of related backups for restoration.

### CountBackupSets

Returns total count of backup set records. Returns pointer to int64 or error.

### CreateBackupSet

Inserts new backup set. Accepts CreateBackupSetParams. Returns created BackupSet pointer or error.

### GetBackupSet

Retrieves single backup set by ID. Accepts backup set ID. Returns BackupSet pointer or error.

### GetPendingBackupSets

Retrieves backup sets with pending status. Returns slice pointer or error. Use for backup coordination.

## BackupVerification Methods

CRUD operations for backup_verifications table. Tracks backup file integrity checks.

### CountVerifications

Returns total count of verification records. Returns pointer to int64 or error.

### CreateVerification

Inserts new verification record. Accepts CreateVerificationParams. Returns created BackupVerification pointer or error.

### GetLatestVerification

Retrieves most recent verification for backup. Accepts backup ID. Returns BackupVerification pointer or error.

### GetVerification

Retrieves single verification by ID. Accepts verification ID. Returns BackupVerification pointer or error.

## ChangeEvent Methods

CRUD operations for change_events table. Audit trail, replication log, webhook source.

### CountChangeEvents

Returns total count of change event records. Returns pointer to int64 or error.

### CreateChangeEventsTable

Creates change_events table with schema. Returns error if creation fails.

### DeleteChangeEvent

Deletes change event by ID. Accepts event ID. Returns error if deletion fails. Use for log rotation.

### DropChangeEventsTable

Drops change_events table. Dangerous operation for schema migrations. Returns error if drop fails.

### GetChangeEvent

Retrieves single change event by ID. Accepts event ID. Returns ChangeEvent pointer or error.

### GetChangeEventsByRecord

Retrieves all events for specific record. Accepts table name and record ID. Returns slice pointer or error. Use for audit history.

### GetUnconsumedEvents

Retrieves events not yet processed by webhooks. Accepts limit count. Returns slice pointer or error. Ordered by HLC timestamp.

### GetUnsyncedEvents

Retrieves events not yet synced to other nodes. Accepts limit count. Returns slice pointer or error. Use for replication.

### ListChangeEvents

Retrieves change events with filters. Accepts ListChangeEventsParams for table filter, operation filter, date range. Returns slice pointer or error.

### MarkEventConsumed

Marks event as consumed by webhooks. Accepts event ID. Returns error if update fails. Sets consumed_at timestamp.

### MarkEventSynced

Marks event as synced to other nodes. Accepts event ID. Returns error if update fails. Sets synced_at timestamp.

### RecordChangeEvent

Inserts new change event. Accepts RecordChangeEventParams. Returns created ChangeEvent pointer or error. Use for custom event logging.

## ContentData Methods

CRUD operations for content_data table. Client-facing content forming tree structures via sibling pointers.

### CountContentData

Returns total count of content records. Returns pointer to int64 or error.

### CreateContentData

Inserts new content record with audit context. Accepts context, audit context, and CreateContentDataParams. Returns created ContentData pointer or error. Records change event.

### CreateContentDataTable

Creates content_data table with schema. Returns error if creation fails.

### DeleteContentData

Deletes content record by ID with audit trail. Accepts context, audit context, and content ID. Returns error if deletion fails. Records change event.

### GetContentData

Retrieves single content record by ID. Accepts content ID. Returns ContentData pointer or error.

### ListContentData

Retrieves all content records. Returns slice pointer or error. Not recommended for large datasets.

### ListContentDataByRoute

Retrieves content for specific route. Accepts nullable route ID. Returns slice pointer or error. Filtered by route_id foreign key.

### ListContentDataPaginated

Retrieves content with pagination. Accepts PaginationParams. Returns slice pointer or error.

### ListContentDataByRoutePaginated

Retrieves content by route with pagination. Accepts ListContentDataByRoutePaginatedParams. Returns slice pointer or error.

### ListRootContentSummary

Retrieves summary of root content nodes. Returns slice of RootContentSummary or error. Use for route listing and tree navigation.

### UpdateContentData

Updates content record with audit trail. Accepts context, audit context, and UpdateContentDataParams. Returns updated ID string pointer or error. Records change event.

## ContentField Methods

CRUD operations for content_fields table. Stores field values for client-facing content nodes.

### CountContentFields

Returns total count of content field records. Returns pointer to int64 or error.

### CreateContentField

Inserts new content field value with audit context. Accepts context, audit context, and CreateContentFieldParams. Returns created ContentFields pointer or error. Records change event.

### CreateContentFieldTable

Creates content_fields table with schema. Returns error if creation fails.

### DeleteContentField

Deletes content field by ID with audit trail. Accepts context, audit context, and content field ID. Returns error if deletion fails. Records change event.

### GetContentField

Retrieves single content field by ID. Accepts content field ID. Returns ContentFields pointer or error.

### GetContentFieldsByRoute

Retrieves content fields for route with joined data. Accepts nullable route ID. Returns slice of GetContentFieldsByRouteRow or error. Includes joined field definitions.

### ListContentFields

Retrieves all content field records. Returns slice pointer or error.

### ListContentFieldsByRoute

Retrieves content fields for specific route. Accepts nullable route ID. Returns slice pointer or error.

### ListContentFieldsByContentData

Retrieves fields for specific content node. Accepts nullable content ID. Returns slice pointer or error.

### ListContentFieldsPaginated

Retrieves content fields with pagination. Accepts PaginationParams. Returns slice pointer or error.

### ListContentFieldsByRoutePaginated

Retrieves content fields by route with pagination. Accepts ListContentFieldsByRoutePaginatedParams. Returns slice pointer or error.

### ListContentFieldsByContentDataPaginated

Retrieves fields by content with pagination. Accepts ListContentFieldsByContentDataPaginatedParams. Returns slice pointer or error.

### UpdateContentField

Updates content field value with audit trail. Accepts context, audit context, and UpdateContentFieldParams. Returns updated ID string pointer or error. Records change event.

## ContentRelation Methods

CRUD operations for content_relations table. Links content nodes through relation fields with sort ordering.

### CountContentRelations

Returns total count of content relation records. Returns pointer to int64 or error.

### CreateContentRelation

Inserts new content relation with audit context. Accepts context, audit context, and CreateContentRelationParams. Returns created ContentRelations pointer or error. Records change event.

### CreateContentRelationTable

Creates content_relations table with schema. Returns error if creation fails.

### DeleteContentRelation

Deletes content relation by ID with audit trail. Accepts context, audit context, and content relation ID. Returns error if deletion fails. Records change event.

### DropContentRelationTable

Drops content_relations table. Dangerous operation for schema migrations. Returns error if drop fails.

### GetContentRelation

Retrieves single content relation by ID. Accepts content relation ID. Returns ContentRelations pointer or error.

### ListContentRelationsBySource

Retrieves relations where source matches given content ID. Accepts source content ID. Returns slice pointer or error.

### ListContentRelationsByTarget

Retrieves relations where target matches given content ID. Accepts target content ID. Returns slice pointer or error.

### ListContentRelationsBySourceAndField

Retrieves relations filtered by source content and field. Accepts source content ID and field ID. Returns slice pointer or error.

### UpdateContentRelationSortOrder

Updates sort order for relation. Accepts context, audit context, and UpdateContentRelationSortOrderParams. Returns error if update fails. Records change event.

## Datatype Methods

CRUD operations for datatypes table. Defines client-facing content types with optional parent for hierarchies.

### CountDatatypes

Returns total count of datatype records. Returns pointer to int64 or error.

### CreateDatatype

Inserts new datatype with audit context. Accepts context, audit context, and CreateDatatypeParams. Returns created Datatypes pointer or error. Records change event.

### CreateDatatypeTable

Creates datatypes table with schema. Returns error if creation fails.

### DeleteDatatype

Deletes datatype by ID with audit trail. Accepts context, audit context, and datatype ID. Returns error if deletion fails. Records change event.

### GetDatatype

Retrieves single datatype by ID. Accepts datatype ID. Returns Datatypes pointer or error.

### ListDatatypes

Retrieves all datatype records. Returns slice pointer or error.

### ListDatatypesRoot

Retrieves root datatypes with no parent. Returns slice pointer or error. Use for top-level datatype listing.

### ListDatatypeChildren

Retrieves child datatypes for parent. Accepts parent datatype ID. Returns slice pointer or error. Use for hierarchical navigation.

### ListDatatypesPaginated

Retrieves datatypes with pagination. Accepts PaginationParams. Returns slice pointer or error.

### ListDatatypeChildrenPaginated

Retrieves child datatypes with pagination. Accepts ListDatatypeChildrenPaginatedParams containing parent filter. Returns slice pointer or error.

### UpdateDatatype

Updates datatype with audit trail. Accepts context, audit context, and UpdateDatatypeParams. Returns updated ID string pointer or error. Records change event.

## DatatypeField Methods

CRUD operations for datatypes_fields junction table. Links datatypes to field definitions with sort ordering.

### CountDatatypeFields

Returns total count of datatype field records. Returns pointer to int64 or error.

### CreateDatatypeField

Inserts new datatype field link with audit context. Accepts context, audit context, and CreateDatatypeFieldParams. Returns created DatatypeFields pointer or error. Records change event.

### CreateDatatypeFieldTable

Creates datatypes_fields table with schema. Returns error if creation fails.

### DeleteDatatypeField

Deletes datatype field link by composite ID with audit trail. Accepts context, audit context, and string ID. Returns error if deletion fails. Records change event.

### GetMaxSortOrderByDatatypeID

Retrieves highest sort_order value for datatype. Accepts datatype ID. Returns int64 max value or error. Use for appending new fields.

### ListDatatypeField

Retrieves all datatype field links. Returns slice pointer or error.

### ListDatatypeFieldByDatatypeID

Retrieves field links for specific datatype. Accepts datatype ID. Returns slice pointer or error.

### ListDatatypeFieldByFieldID

Retrieves datatype links for specific field. Accepts field ID. Returns slice pointer or error.

### ListDatatypeFieldPaginated

Retrieves datatype field links with pagination. Accepts PaginationParams. Returns slice pointer or error.

### ListDatatypeFieldByDatatypeIDPaginated

Retrieves field links by datatype with pagination. Accepts ListDatatypeFieldByDatatypeIDPaginatedParams. Returns slice pointer or error.

### ListDatatypeFieldByFieldIDPaginated

Retrieves datatype links by field with pagination. Accepts ListDatatypeFieldByFieldIDPaginatedParams. Returns slice pointer or error.

### UpdateDatatypeField

Updates datatype field link with audit trail. Accepts context, audit context, and UpdateDatatypeFieldParams. Returns updated ID string pointer or error. Records change event.

### UpdateDatatypeFieldSortOrder

Updates sort order for datatype field link. Accepts context, audit context, string ID, and int64 sort order. Returns error if update fails. Records change event.

## Field Methods

CRUD operations for fields table. Client-facing field definitions with validation and UI config.

### CountFields

Returns total count of field records. Returns pointer to int64 or error.

### CreateField

Inserts new field with audit context. Accepts context, audit context, and CreateFieldParams. Returns created Fields pointer or error. Records change event.

### CreateFieldTable

Creates fields table with schema. Returns error if creation fails.

### DeleteField

Deletes field by ID with audit trail. Accepts context, audit context, and field ID. Returns error if deletion fails. Records change event.

### GetField

Retrieves single field by ID. Accepts field ID. Returns Fields pointer or error.

### GetFieldDefinitionsByRoute

Retrieves field definitions for route with joined data. Accepts nullable route ID. Returns slice of GetFieldDefinitionsByRouteRow or error. Includes joined datatype and junction data.

### ListFields

Retrieves all field records. Returns slice pointer or error.

### ListFieldsByDatatypeID

Retrieves fields for specific datatype. Accepts nullable datatype ID. Returns slice pointer or error.

### ListFieldsPaginated

Retrieves fields with pagination. Accepts PaginationParams. Returns slice pointer or error.

### UpdateField

Updates field with audit trail. Accepts context, audit context, and UpdateFieldParams. Returns updated ID string pointer or error. Records change event.

## Media Methods

CRUD operations for media table. Tracks uploaded files in S3-compatible storage with metadata.

### CountMedia

Returns total count of media records. Returns pointer to int64 or error.

### CreateMedia

Inserts new media record with audit context. Accepts context, audit context, and CreateMediaParams. Returns created Media pointer or error. Records change event.

### CreateMediaTable

Creates media table with schema. Returns error if creation fails.

### DeleteMedia

Deletes media record by ID with audit trail. Accepts context, audit context, and media ID. Returns error if deletion fails. Records change event. Does not delete file from storage.

### GetMedia

Retrieves single media by ID. Accepts media ID. Returns Media pointer or error.

### GetMediaByName

Retrieves media by filename. Accepts string name. Returns Media pointer or error.

### GetMediaByURL

Retrieves media by URL. Accepts URL type. Returns Media pointer or error.

### ListMedia

Retrieves all media records. Returns slice pointer or error.

### ListMediaPaginated

Retrieves media with pagination. Accepts PaginationParams. Returns slice pointer or error.

### UpdateMedia

Updates media record with audit trail. Accepts context, audit context, and UpdateMediaParams. Returns updated ID string pointer or error. Records change event.

## MediaDimension Methods

CRUD operations for media_dimensions table. Defines responsive image size presets.

### CountMediaDimensions

Returns total count of media dimension records. Returns pointer to int64 or error.

### CreateMediaDimension

Inserts new media dimension with audit context. Accepts context, audit context, and CreateMediaDimensionParams. Returns created MediaDimensions pointer or error. Records change event.

### CreateMediaDimensionTable

Creates media_dimensions table with schema. Returns error if creation fails.

### DeleteMediaDimension

Deletes media dimension by ID with audit trail. Accepts context, audit context, and string ID. Returns error if deletion fails. Records change event.

### GetMediaDimension

Retrieves single media dimension by ID. Accepts string ID. Returns MediaDimensions pointer or error.

### ListMediaDimensions

Retrieves all media dimension records. Returns slice pointer or error.

### UpdateMediaDimension

Updates media dimension with audit trail. Accepts context, audit context, and UpdateMediaDimensionParams. Returns updated ID string pointer or error. Records change event.

## Permission Methods

CRUD operations for permissions table. Defines access control rules for tables and resources.

### CountPermissions

Returns total count of permission records. Returns pointer to int64 or error.

### CreatePermission

Inserts new permission with audit context. Accepts context, audit context, and CreatePermissionParams. Returns created Permissions pointer or error. Records change event.

### CreatePermissionTable

Creates permissions table with schema. Returns error if creation fails.

### DeletePermission

Deletes permission by ID with audit trail. Accepts context, audit context, and permission ID. Returns error if deletion fails. Records change event.

### GetPermission

Retrieves single permission by ID. Accepts permission ID. Returns Permissions pointer or error.

### ListPermissions

Retrieves all permission records. Returns slice pointer or error.

### UpdatePermission

Updates permission with audit trail. Accepts context, audit context, and UpdatePermissionParams. Returns updated ID string pointer or error. Records change event.

## Role Methods

CRUD operations for roles table. Groups permissions into assignable sets for users.

### CountRoles

Returns total count of role records. Returns pointer to int64 or error.

### CreateRole

Inserts new role with audit context. Accepts context, audit context, and CreateRoleParams. Returns created Roles pointer or error. Records change event.

### CreateRoleTable

Creates roles table with schema. Returns error if creation fails.

### DeleteRole

Deletes role by ID with audit trail. Accepts context, audit context, and role ID. Returns error if deletion fails. Records change event.

### GetRole

Retrieves single role by ID. Accepts role ID. Returns Roles pointer or error.

### ListRoles

Retrieves all role records. Returns slice pointer or error.

### UpdateRole

Updates role with audit trail. Accepts context, audit context, and UpdateRoleParams. Returns updated ID string pointer or error. Records change event.

## Route Methods

CRUD operations for routes table. Client-facing URL routes serving content trees.

### CountRoutes

Returns total count of route records. Returns pointer to int64 or error.

### CreateRoute

Inserts new route with audit context. Accepts context, audit context, and CreateRouteParams. Returns created Routes pointer or error. Records change event.

### CreateRouteTable

Creates routes table with schema. Returns error if creation fails.

### DeleteRoute

Deletes route by ID with audit trail. Accepts context, audit context, and route ID. Returns error if deletion fails. Records change event.

### GetContentTreeByRoute

Retrieves complete content tree for route. Accepts nullable route ID. Returns slice of GetContentTreeByRouteRow with denormalized tree data. Use for rendering content hierarchies.

### GetRoute

Retrieves single route by ID. Accepts route ID. Returns Routes pointer or error.

### GetRouteID

Retrieves route ID by slug. Accepts slug string. Returns RouteID pointer or error.

### GetRouteTreeByRouteID

Retrieves route tree structure. Accepts nullable route ID. Returns slice of GetRouteTreeByRouteIDRow. Use for navigation menus.

### ListRoutes

Retrieves all route records. Returns slice pointer or error.

### ListRoutesByDatatype

Retrieves routes filtered by datatype. Accepts datatype ID. Returns slice pointer or error.

### ListRoutesPaginated

Retrieves routes with pagination. Accepts PaginationParams. Returns slice pointer or error.

### UpdateRoute

Updates route with audit trail. Accepts context, audit context, and UpdateRouteParams. Returns updated ID string pointer or error. Records change event.

## Session Methods

CRUD operations for sessions table. Tracks active user sessions with authentication state.

### CountSessions

Returns total count of session records. Returns pointer to int64 or error.

### CreateSession

Inserts new session with audit context. Accepts context, audit context, and CreateSessionParams. Returns created Sessions pointer or error. Records change event.

### CreateSessionTable

Creates sessions table with schema. Returns error if creation fails.

### DeleteSession

Deletes session by ID with audit trail. Accepts context, audit context, and session ID. Returns error if deletion fails. Records change event.

### GetSession

Retrieves single session by ID. Accepts session ID. Returns Sessions pointer or error.

### GetSessionByUserId

Retrieves active session for user. Accepts nullable user ID. Returns Sessions pointer or error.

### ListSessions

Retrieves all session records. Returns slice pointer or error.

### UpdateSession

Updates session with audit trail. Accepts context, audit context, and UpdateSessionParams. Returns updated ID string pointer or error. Records change event.

## Table Methods

CRUD operations for tables registry. Tracks all database tables for plugin system access.

### CountTables

Returns total count of table registry records. Returns pointer to int64 or error.

### CreateTable

Inserts new table registry entry with audit context. Accepts context, audit context, and CreateTableParams. Returns created Tables pointer or error. Records change event.

### CreateTableTable

Creates tables table with schema. Returns error if creation fails.

### DeleteTable

Deletes table registry entry by ID with audit trail. Accepts context, audit context, and string ID. Returns error if deletion fails. Records change event.

### GetTable

Retrieves single table registry entry by ID. Accepts string ID. Returns Tables pointer or error.

### ListTables

Retrieves all table registry records. Returns slice pointer or error.

### UpdateTable

Updates table registry entry with audit trail. Accepts context, audit context, and UpdateTableParams. Returns updated ID string pointer or error. Records change event.

## Token Methods

CRUD operations for tokens table. API tokens, refresh tokens, verification tokens.

### CountTokens

Returns total count of token records. Returns pointer to int64 or error.

### CreateToken

Inserts new token with audit context. Accepts context, audit context, and CreateTokenParams. Returns created Tokens pointer or error. Records change event.

### CreateTokenTable

Creates tokens table with schema. Returns error if creation fails.

### DeleteToken

Deletes token by ID with audit trail. Accepts context, audit context, and string ID. Returns error if deletion fails. Records change event.

### GetToken

Retrieves single token by ID. Accepts string ID. Returns Tokens pointer or error.

### GetTokenByTokenValue

Retrieves token by token value. Accepts string token. Returns Tokens pointer or error.

### GetTokenByUserId

Retrieves all tokens for user. Accepts nullable user ID. Returns slice pointer or error.

### ListTokens

Retrieves all token records. Returns slice pointer or error.

### UpdateToken

Updates token with audit trail. Accepts context, audit context, and UpdateTokenParams. Returns updated ID string pointer or error. Records change event.

## User Methods

CRUD operations for users table. System user accounts with authentication and permissions.

### CountUsers

Returns total count of user records. Returns pointer to int64 or error.

### CreateUser

Inserts new user with audit context. Accepts context, audit context, and CreateUserParams. Returns created Users pointer or error. Records change event.

### CreateUserTable

Creates users table with schema. Returns error if creation fails.

### DeleteUser

Deletes user by ID with audit trail. Accepts context, audit context, and user ID. Returns error if deletion fails. Records change event.

### GetUser

Retrieves single user by ID. Accepts user ID. Returns Users pointer or error.

### GetUserByEmail

Retrieves user by email address. Accepts email type. Returns Users pointer or error.

### GetUserBySSHFingerprint

Retrieves user by SSH key fingerprint. Accepts fingerprint string. Returns Users pointer or error.

### ListUsers

Retrieves all user records. Returns slice pointer or error.

### UpdateUser

Updates user with audit trail. Accepts context, audit context, and UpdateUserParams. Returns updated ID string pointer or error. Records change event.

## UserOauth Methods

CRUD operations for user_oauth table. Links users to external OAuth providers.

### CountUserOauths

Returns total count of user OAuth records. Returns pointer to int64 or error.

### CreateUserOauth

Inserts new OAuth link with audit context. Accepts context, audit context, and CreateUserOauthParams. Returns created UserOauth pointer or error. Records change event.

### CreateUserOauthTable

Creates user_oauth table with schema. Returns error if creation fails.

### DeleteUserOauth

Deletes OAuth link by ID with audit trail. Accepts context, audit context, and user OAuth ID. Returns error if deletion fails. Records change event.

### GetUserOauth

Retrieves single OAuth link by ID. Accepts user OAuth ID. Returns UserOauth pointer or error.

### GetUserOauthByProviderID

Retrieves OAuth link by provider and provider user ID. Accepts provider string and provider user ID string. Returns UserOauth pointer or error.

### GetUserOauthByUserId

Retrieves OAuth link for user. Accepts nullable user ID. Returns UserOauth pointer or error.

### ListUserOauths

Retrieves all OAuth link records. Returns slice pointer or error.

### UpdateUserOauth

Updates OAuth link with audit trail. Accepts context, audit context, and UpdateUserOauthParams. Returns updated ID string pointer or error. Records change event.

## UserSshKey Methods

CRUD operations for user_ssh_keys table. Public keys for SSH-based TUI authentication.

### CountUserSshKeys

Returns total count of SSH key records. Returns pointer to int64 or error.

### CreateUserSshKey

Inserts new SSH key with audit context. Accepts context, audit context, and CreateUserSshKeyParams. Returns created UserSshKeys pointer or error. Records change event.

### CreateUserSshKeyTable

Creates user_ssh_keys table with schema. Returns error if creation fails.

### DeleteUserSshKey

Deletes SSH key by ID with audit trail. Accepts context, audit context, and string ID. Returns error if deletion fails. Records change event.

### GetUserSshKey

Retrieves single SSH key by ID. Accepts string ID. Returns UserSshKeys pointer or error.

### GetUserSshKeyByFingerprint

Retrieves SSH key by fingerprint. Accepts fingerprint string. Returns UserSshKeys pointer or error.

### ListUserSshKeys

Retrieves SSH keys for user. Accepts nullable user ID. Returns slice pointer or error.

### UpdateUserSshKeyLabel

Updates SSH key label with audit trail. Accepts context, audit context, string ID, and label string. Returns error if update fails. Records change event.

### UpdateUserSshKeyLastUsed

Updates SSH key last used timestamp. Accepts string ID and timestamp string. Returns error if update fails. Does not record change event.
