// Code generated by tools/dbgen; DO NOT EDIT.
package db

import (
	"fmt"

	mdbm "github.com/hegner123/modulacms/internal/db-mysql"
	mdbp "github.com/hegner123/modulacms/internal/db-psql"
	mdb "github.com/hegner123/modulacms/internal/db-sqlite"
	"github.com/hegner123/modulacms/internal/db/types"
)

///////////////////////////////
// STRUCTS
//////////////////////////////

// Permissions represents a permission record in the database.
type Permissions struct {
	PermissionID    types.PermissionID `json:"permission_id"`
	Label           string             `json:"label"`
	SystemProtected bool               `json:"system_protected"`
}

// CreatePermissionParams contains parameters for creating a new permission.
type CreatePermissionParams struct {
	Label           string `json:"label"`
	SystemProtected bool   `json:"system_protected"`
}

// UpdatePermissionParams contains parameters for updating an existing permission.
type UpdatePermissionParams struct {
	Label           string             `json:"label"`
	SystemProtected bool               `json:"system_protected"`
	PermissionID    types.PermissionID `json:"permission_id"`
}

// MapStringPermission converts Permissions to StringPermissions for TUI display.
func MapStringPermission(a Permissions) StringPermissions {
	return StringPermissions{
		PermissionID: a.PermissionID.String(),
		Label:        a.Label,
	}
}

///////////////////////////////
// SQLITE
//////////////////////////////

// QUERIES

// CountPermissions returns the total number of permissions in the database.
func (d Database) CountPermissions() (*int64, error) {
	queries := mdb.New(d.Connection)
	c, err := queries.CountPermission(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreatePermissionTable creates the permissions table in the database.
func (d Database) CreatePermissionTable() error {
	queries := mdb.New(d.Connection)
	err := queries.CreatePermissionTable(d.Context)
	return err
}

// GetPermission retrieves a permission by ID.
func (d Database) GetPermission(id types.PermissionID) (*Permissions, error) {
	queries := mdb.New(d.Connection)
	row, err := queries.GetPermission(d.Context, mdb.GetPermissionParams{PermissionID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapPermission(row)
	return &res, nil
}

// ListPermissions retrieves all permissions in the database.
func (d Database) ListPermissions() (*[]Permissions, error) {
	queries := mdb.New(d.Connection)
	rows, err := queries.ListPermission(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Permissions: %v\n", err)
	}
	res := []Permissions{}
	for _, v := range rows {
		m := d.MapPermission(v)
		res = append(res, m)
	}
	return &res, nil
}

///////////////////////////////
// MYSQL
//////////////////////////////

// QUERIES

// CountPermissions returns the total number of permissions in the database.
func (d MysqlDatabase) CountPermissions() (*int64, error) {
	queries := mdbm.New(d.Connection)
	c, err := queries.CountPermission(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreatePermissionTable creates the permissions table in the database.
func (d MysqlDatabase) CreatePermissionTable() error {
	queries := mdbm.New(d.Connection)
	err := queries.CreatePermissionTable(d.Context)
	return err
}

// GetPermission retrieves a permission by ID.
func (d MysqlDatabase) GetPermission(id types.PermissionID) (*Permissions, error) {
	queries := mdbm.New(d.Connection)
	row, err := queries.GetPermission(d.Context, mdbm.GetPermissionParams{PermissionID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapPermission(row)
	return &res, nil
}

// ListPermissions retrieves all permissions in the database.
func (d MysqlDatabase) ListPermissions() (*[]Permissions, error) {
	queries := mdbm.New(d.Connection)
	rows, err := queries.ListPermission(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Permissions: %v\n", err)
	}
	res := []Permissions{}
	for _, v := range rows {
		m := d.MapPermission(v)
		res = append(res, m)
	}
	return &res, nil
}

///////////////////////////////
// POSTGRES
//////////////////////////////

// QUERIES

// CountPermissions returns the total number of permissions in the database.
func (d PsqlDatabase) CountPermissions() (*int64, error) {
	queries := mdbp.New(d.Connection)
	c, err := queries.CountPermission(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreatePermissionTable creates the permissions table in the database.
func (d PsqlDatabase) CreatePermissionTable() error {
	queries := mdbp.New(d.Connection)
	err := queries.CreatePermissionTable(d.Context)
	return err
}

// GetPermission retrieves a permission by ID.
func (d PsqlDatabase) GetPermission(id types.PermissionID) (*Permissions, error) {
	queries := mdbp.New(d.Connection)
	row, err := queries.GetPermission(d.Context, mdbp.GetPermissionParams{PermissionID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapPermission(row)
	return &res, nil
}

// ListPermissions retrieves all permissions in the database.
func (d PsqlDatabase) ListPermissions() (*[]Permissions, error) {
	queries := mdbp.New(d.Connection)
	rows, err := queries.ListPermission(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Permissions: %v\n", err)
	}
	res := []Permissions{}
	for _, v := range rows {
		m := d.MapPermission(v)
		res = append(res, m)
	}
	return &res, nil
}
