// Code generated by tools/dbgen; DO NOT EDIT.
package db

import (
	"context"
	"database/sql"
	"fmt"

	mdbm "github.com/hegner123/modulacms/internal/db-mysql"
	mdbp "github.com/hegner123/modulacms/internal/db-psql"
	mdb "github.com/hegner123/modulacms/internal/db-sqlite"
	"github.com/hegner123/modulacms/internal/db/audited"
	"github.com/hegner123/modulacms/internal/db/types"
)

///////////////////////////////
// STRUCTS
//////////////////////////////

// Fields represents a field record in the database.
type Fields struct {
	FieldID      types.FieldID            `json:"field_id"`
	ParentID     types.NullableDatatypeID `json:"parent_id"`
	Label        string                   `json:"label"`
	Data         string                   `json:"data"`
	Validation   string                   `json:"validation"`
	UIConfig     string                   `json:"ui_config"`
	Type         types.FieldType          `json:"type"`
	AuthorID     types.NullableUserID     `json:"author_id"`
	DateCreated  types.Timestamp          `json:"date_created"`
	DateModified types.Timestamp          `json:"date_modified"`
}

// CreateFieldParams contains parameters for creating a new field.
type CreateFieldParams struct {
	FieldID      types.FieldID            `json:"field_id"`
	ParentID     types.NullableDatatypeID `json:"parent_id"`
	Label        string                   `json:"label"`
	Data         string                   `json:"data"`
	Validation   string                   `json:"validation"`
	UIConfig     string                   `json:"ui_config"`
	Type         types.FieldType          `json:"type"`
	AuthorID     types.NullableUserID     `json:"author_id"`
	DateCreated  types.Timestamp          `json:"date_created"`
	DateModified types.Timestamp          `json:"date_modified"`
}

// UpdateFieldParams contains parameters for updating an existing field.
type UpdateFieldParams struct {
	ParentID     types.NullableDatatypeID `json:"parent_id"`
	Label        string                   `json:"label"`
	Data         string                   `json:"data"`
	Validation   string                   `json:"validation"`
	UIConfig     string                   `json:"ui_config"`
	Type         types.FieldType          `json:"type"`
	AuthorID     types.NullableUserID     `json:"author_id"`
	DateCreated  types.Timestamp          `json:"date_created"`
	DateModified types.Timestamp          `json:"date_modified"`
	FieldID      types.FieldID            `json:"field_id"`
}

// MapStringField converts Fields to StringFields for TUI display.
func MapStringField(a Fields) StringFields {
	return StringFields{
		FieldID:      a.FieldID.String(),
		ParentID:     a.ParentID.String(),
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UIConfig:     a.UIConfig,
		Type:         a.Type.String(),
		AuthorID:     a.AuthorID.String(),
		DateCreated:  a.DateCreated.String(),
		DateModified: a.DateModified.String(),
		History:      "",
	}
}

///////////////////////////////
// SQLITE
//////////////////////////////

// MAPS

// MapField converts a sqlc-generated SQLite field to the wrapper type.
func (d Database) MapField(a mdb.Fields) Fields {
	return Fields{
		FieldID:      a.FieldID,
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UIConfig:     a.UiConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
	}
}

// MapCreateFieldParams converts wrapper params to sqlc-generated SQLite params.
func (d Database) MapCreateFieldParams(a CreateFieldParams) mdb.CreateFieldParams {
	id := a.FieldID
	if id.IsZero() {
		id = types.NewFieldID()
	}
	return mdb.CreateFieldParams{
		FieldID:      id,
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UiConfig:     a.UIConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
	}
}

// MapUpdateFieldParams converts wrapper params to sqlc-generated SQLite params.
func (d Database) MapUpdateFieldParams(a UpdateFieldParams) mdb.UpdateFieldParams {
	return mdb.UpdateFieldParams{
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UiConfig:     a.UIConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
		FieldID:      a.FieldID,
	}
}

// QUERIES

// CountFields returns the total number of fields in the database.
func (d Database) CountFields() (*int64, error) {
	queries := mdb.New(d.Connection)
	c, err := queries.CountField(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreateFieldTable creates the fields table in the database.
func (d Database) CreateFieldTable() error {
	queries := mdb.New(d.Connection)
	err := queries.CreateFieldTable(d.Context)
	return err
}

// CreateField inserts a new field and records an audit event.
func (d Database) CreateField(ctx context.Context, ac audited.AuditContext, s CreateFieldParams) (*Fields, error) {
	cmd := d.NewFieldCmd(ctx, ac, s)
	result, err := audited.Create(cmd)
	if err != nil {
		return nil, fmt.Errorf("failed to create field: %w", err)
	}
	r := d.MapField(result)
	return &r, nil
}

// DeleteField removes a field and records an audit event.
func (d Database) DeleteField(ctx context.Context, ac audited.AuditContext, id types.FieldID) error {
	cmd := d.DeleteFieldCmd(ctx, ac, id)
	return audited.Delete(cmd)
}

// GetField retrieves a field by ID.
func (d Database) GetField(id types.FieldID) (*Fields, error) {
	queries := mdb.New(d.Connection)
	row, err := queries.GetField(d.Context, mdb.GetFieldParams{FieldID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapField(row)
	return &res, nil
}

// ListFields retrieves all fields in the database.
func (d Database) ListFields() (*[]Fields, error) {
	queries := mdb.New(d.Connection)
	rows, err := queries.ListField(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Fields: %v\n", err)
	}
	res := []Fields{}
	for _, v := range rows {
		m := d.MapField(v)
		res = append(res, m)
	}
	return &res, nil
}

// UpdateField modifies an existing field and records an audit event.
func (d Database) UpdateField(ctx context.Context, ac audited.AuditContext, s UpdateFieldParams) (*string, error) {
	cmd := d.UpdateFieldCmd(ctx, ac, s)
	if err := audited.Update(cmd); err != nil {
		return nil, fmt.Errorf("failed to update field: %w", err)
	}
	msg := fmt.Sprintf("Successfully updated %v\n", s.Label)
	return &msg, nil
}

// ListFieldsByDatatypeID retrieves fields by datatypeID.
func (d Database) ListFieldsByDatatypeID(datatypeID types.NullableDatatypeID) (*[]Fields, error) {
	queries := mdb.New(d.Connection)
	rows, err := queries.ListFieldByDatatypeID(d.Context, mdb.ListFieldByDatatypeIDParams{ParentID: datatypeID})
	if err != nil {
		return nil, fmt.Errorf("failed to get Fields by datatypeID: %v\n", err)
	}
	res := []Fields{}
	for _, v := range rows {
		m := d.MapField(v)
		res = append(res, m)
	}
	return &res, nil
}

///////////////////////////////
// MYSQL
//////////////////////////////

// MAPS

// MapField converts a sqlc-generated MySQL field to the wrapper type.
func (d MysqlDatabase) MapField(a mdbm.Fields) Fields {
	return Fields{
		FieldID:      a.FieldID,
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UIConfig:     a.UiConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
	}
}

// MapCreateFieldParams converts wrapper params to sqlc-generated MySQL params.
func (d MysqlDatabase) MapCreateFieldParams(a CreateFieldParams) mdbm.CreateFieldParams {
	id := a.FieldID
	if id.IsZero() {
		id = types.NewFieldID()
	}
	return mdbm.CreateFieldParams{
		FieldID:      id,
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UiConfig:     a.UIConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
	}
}

// MapUpdateFieldParams converts wrapper params to sqlc-generated MySQL params.
func (d MysqlDatabase) MapUpdateFieldParams(a UpdateFieldParams) mdbm.UpdateFieldParams {
	return mdbm.UpdateFieldParams{
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UiConfig:     a.UIConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
		FieldID:      a.FieldID,
	}
}

// QUERIES

// CountFields returns the total number of fields in the database.
func (d MysqlDatabase) CountFields() (*int64, error) {
	queries := mdbm.New(d.Connection)
	c, err := queries.CountField(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreateFieldTable creates the fields table in the database.
func (d MysqlDatabase) CreateFieldTable() error {
	queries := mdbm.New(d.Connection)
	err := queries.CreateFieldTable(d.Context)
	return err
}

// CreateField inserts a new field and records an audit event.
func (d MysqlDatabase) CreateField(ctx context.Context, ac audited.AuditContext, s CreateFieldParams) (*Fields, error) {
	cmd := d.NewFieldCmd(ctx, ac, s)
	result, err := audited.Create(cmd)
	if err != nil {
		return nil, fmt.Errorf("failed to create field: %w", err)
	}
	r := d.MapField(result)
	return &r, nil
}

// DeleteField removes a field and records an audit event.
func (d MysqlDatabase) DeleteField(ctx context.Context, ac audited.AuditContext, id types.FieldID) error {
	cmd := d.DeleteFieldCmd(ctx, ac, id)
	return audited.Delete(cmd)
}

// GetField retrieves a field by ID.
func (d MysqlDatabase) GetField(id types.FieldID) (*Fields, error) {
	queries := mdbm.New(d.Connection)
	row, err := queries.GetField(d.Context, mdbm.GetFieldParams{FieldID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapField(row)
	return &res, nil
}

// ListFields retrieves all fields in the database.
func (d MysqlDatabase) ListFields() (*[]Fields, error) {
	queries := mdbm.New(d.Connection)
	rows, err := queries.ListField(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Fields: %v\n", err)
	}
	res := []Fields{}
	for _, v := range rows {
		m := d.MapField(v)
		res = append(res, m)
	}
	return &res, nil
}

// UpdateField modifies an existing field and records an audit event.
func (d MysqlDatabase) UpdateField(ctx context.Context, ac audited.AuditContext, s UpdateFieldParams) (*string, error) {
	cmd := d.UpdateFieldCmd(ctx, ac, s)
	if err := audited.Update(cmd); err != nil {
		return nil, fmt.Errorf("failed to update field: %w", err)
	}
	msg := fmt.Sprintf("Successfully updated %v\n", s.Label)
	return &msg, nil
}

// ListFieldsByDatatypeID retrieves fields by datatypeID.
func (d MysqlDatabase) ListFieldsByDatatypeID(datatypeID types.NullableDatatypeID) (*[]Fields, error) {
	queries := mdbm.New(d.Connection)
	rows, err := queries.ListFieldByDatatypeID(d.Context, mdbm.ListFieldByDatatypeIDParams{ParentID: datatypeID})
	if err != nil {
		return nil, fmt.Errorf("failed to get Fields by datatypeID: %v\n", err)
	}
	res := []Fields{}
	for _, v := range rows {
		m := d.MapField(v)
		res = append(res, m)
	}
	return &res, nil
}

///////////////////////////////
// POSTGRES
//////////////////////////////

// MAPS

// MapField converts a sqlc-generated PostgreSQL field to the wrapper type.
func (d PsqlDatabase) MapField(a mdbp.Fields) Fields {
	return Fields{
		FieldID:      a.FieldID,
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UIConfig:     a.UiConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
	}
}

// MapCreateFieldParams converts wrapper params to sqlc-generated PostgreSQL params.
func (d PsqlDatabase) MapCreateFieldParams(a CreateFieldParams) mdbp.CreateFieldParams {
	id := a.FieldID
	if id.IsZero() {
		id = types.NewFieldID()
	}
	return mdbp.CreateFieldParams{
		FieldID:      id,
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UiConfig:     a.UIConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
	}
}

// MapUpdateFieldParams converts wrapper params to sqlc-generated PostgreSQL params.
func (d PsqlDatabase) MapUpdateFieldParams(a UpdateFieldParams) mdbp.UpdateFieldParams {
	return mdbp.UpdateFieldParams{
		ParentID:     a.ParentID,
		Label:        a.Label,
		Data:         a.Data,
		Validation:   a.Validation,
		UiConfig:     a.UIConfig,
		Type:         a.Type,
		AuthorID:     a.AuthorID,
		DateCreated:  a.DateCreated,
		DateModified: a.DateModified,
		FieldID:      a.FieldID,
	}
}

// QUERIES

// CountFields returns the total number of fields in the database.
func (d PsqlDatabase) CountFields() (*int64, error) {
	queries := mdbp.New(d.Connection)
	c, err := queries.CountField(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreateFieldTable creates the fields table in the database.
func (d PsqlDatabase) CreateFieldTable() error {
	queries := mdbp.New(d.Connection)
	err := queries.CreateFieldTable(d.Context)
	return err
}

// CreateField inserts a new field and records an audit event.
func (d PsqlDatabase) CreateField(ctx context.Context, ac audited.AuditContext, s CreateFieldParams) (*Fields, error) {
	cmd := d.NewFieldCmd(ctx, ac, s)
	result, err := audited.Create(cmd)
	if err != nil {
		return nil, fmt.Errorf("failed to create field: %w", err)
	}
	r := d.MapField(result)
	return &r, nil
}

// DeleteField removes a field and records an audit event.
func (d PsqlDatabase) DeleteField(ctx context.Context, ac audited.AuditContext, id types.FieldID) error {
	cmd := d.DeleteFieldCmd(ctx, ac, id)
	return audited.Delete(cmd)
}

// GetField retrieves a field by ID.
func (d PsqlDatabase) GetField(id types.FieldID) (*Fields, error) {
	queries := mdbp.New(d.Connection)
	row, err := queries.GetField(d.Context, mdbp.GetFieldParams{FieldID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapField(row)
	return &res, nil
}

// ListFields retrieves all fields in the database.
func (d PsqlDatabase) ListFields() (*[]Fields, error) {
	queries := mdbp.New(d.Connection)
	rows, err := queries.ListField(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Fields: %v\n", err)
	}
	res := []Fields{}
	for _, v := range rows {
		m := d.MapField(v)
		res = append(res, m)
	}
	return &res, nil
}

// UpdateField modifies an existing field and records an audit event.
func (d PsqlDatabase) UpdateField(ctx context.Context, ac audited.AuditContext, s UpdateFieldParams) (*string, error) {
	cmd := d.UpdateFieldCmd(ctx, ac, s)
	if err := audited.Update(cmd); err != nil {
		return nil, fmt.Errorf("failed to update field: %w", err)
	}
	msg := fmt.Sprintf("Successfully updated %v\n", s.Label)
	return &msg, nil
}

// ListFieldsByDatatypeID retrieves fields by datatypeID.
func (d PsqlDatabase) ListFieldsByDatatypeID(datatypeID types.NullableDatatypeID) (*[]Fields, error) {
	queries := mdbp.New(d.Connection)
	rows, err := queries.ListFieldByDatatypeID(d.Context, mdbp.ListFieldByDatatypeIDParams{ParentID: datatypeID})
	if err != nil {
		return nil, fmt.Errorf("failed to get Fields by datatypeID: %v\n", err)
	}
	res := []Fields{}
	for _, v := range rows {
		m := d.MapField(v)
		res = append(res, m)
	}
	return &res, nil
}

// ========== AUDITED COMMAND TYPES ==========

// ----- SQLite CREATE -----

// NewFieldCmd is an audited command for creating fields.
type NewFieldCmd struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	params   CreateFieldParams
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c NewFieldCmd) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c NewFieldCmd) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c NewFieldCmd) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c NewFieldCmd) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c NewFieldCmd) TableName() string { return "fields" }

// Params returns the parameters for this command.
func (c NewFieldCmd) Params() any { return c.params }

// GetID extracts the ID from a field record.
func (c NewFieldCmd) GetID(u mdb.Fields) string { return string(u.FieldID) }

// Execute creates the field in the database.
func (c NewFieldCmd) Execute(ctx context.Context, tx audited.DBTX) (mdb.Fields, error) {
	id := c.params.FieldID
	if id.IsZero() {
		id = types.NewFieldID()
	}
	queries := mdb.New(tx)
	return queries.CreateField(ctx, mdb.CreateFieldParams{
		FieldID:      id,
		ParentID:     c.params.ParentID,
		Label:        c.params.Label,
		Data:         c.params.Data,
		Validation:   c.params.Validation,
		UiConfig:     c.params.UIConfig,
		Type:         c.params.Type,
		AuthorID:     c.params.AuthorID,
		DateCreated:  c.params.DateCreated,
		DateModified: c.params.DateModified,
	})
}

// NewFieldCmd creates a command for inserting a field.
func (d Database) NewFieldCmd(ctx context.Context, auditCtx audited.AuditContext, params CreateFieldParams) NewFieldCmd {
	return NewFieldCmd{ctx: ctx, auditCtx: auditCtx, params: params, conn: d.Connection, recorder: SQLiteRecorder}
}

// ----- SQLite UPDATE -----

// UpdateFieldCmd is an audited command for updating fields.
type UpdateFieldCmd struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	params   UpdateFieldParams
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c UpdateFieldCmd) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c UpdateFieldCmd) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c UpdateFieldCmd) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c UpdateFieldCmd) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c UpdateFieldCmd) TableName() string { return "fields" }

// Params returns the parameters for this command.
func (c UpdateFieldCmd) Params() any { return c.params }

// GetID returns the field ID for this command.
func (c UpdateFieldCmd) GetID() string { return string(c.params.FieldID) }

// GetBefore retrieves the field before the update.
func (c UpdateFieldCmd) GetBefore(ctx context.Context, tx audited.DBTX) (mdb.Fields, error) {
	queries := mdb.New(tx)
	return queries.GetField(ctx, mdb.GetFieldParams{FieldID: c.params.FieldID})
}

// Execute updates the field in the database.
func (c UpdateFieldCmd) Execute(ctx context.Context, tx audited.DBTX) error {
	queries := mdb.New(tx)
	return queries.UpdateField(ctx, mdb.UpdateFieldParams{
		ParentID:     c.params.ParentID,
		Label:        c.params.Label,
		Data:         c.params.Data,
		Validation:   c.params.Validation,
		UiConfig:     c.params.UIConfig,
		Type:         c.params.Type,
		AuthorID:     c.params.AuthorID,
		DateCreated:  c.params.DateCreated,
		DateModified: c.params.DateModified,
		FieldID:      c.params.FieldID,
	})
}

// UpdateFieldCmd creates a command for updating a field.
func (d Database) UpdateFieldCmd(ctx context.Context, auditCtx audited.AuditContext, params UpdateFieldParams) UpdateFieldCmd {
	return UpdateFieldCmd{ctx: ctx, auditCtx: auditCtx, params: params, conn: d.Connection, recorder: SQLiteRecorder}
}

// ----- SQLite DELETE -----

// DeleteFieldCmd is an audited command for deleting fields.
type DeleteFieldCmd struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	id       types.FieldID
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c DeleteFieldCmd) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c DeleteFieldCmd) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c DeleteFieldCmd) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c DeleteFieldCmd) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c DeleteFieldCmd) TableName() string { return "fields" }

// GetID returns the field ID for this command.
func (c DeleteFieldCmd) GetID() string { return string(c.id) }

// GetBefore retrieves the field before the delete.
func (c DeleteFieldCmd) GetBefore(ctx context.Context, tx audited.DBTX) (mdb.Fields, error) {
	queries := mdb.New(tx)
	return queries.GetField(ctx, mdb.GetFieldParams{FieldID: c.id})
}

// Execute deletes the field from the database.
func (c DeleteFieldCmd) Execute(ctx context.Context, tx audited.DBTX) error {
	queries := mdb.New(tx)
	return queries.DeleteField(ctx, mdb.DeleteFieldParams{FieldID: c.id})
}

// DeleteFieldCmd creates a command for deleting a field.
func (d Database) DeleteFieldCmd(ctx context.Context, auditCtx audited.AuditContext, id types.FieldID) DeleteFieldCmd {
	return DeleteFieldCmd{ctx: ctx, auditCtx: auditCtx, id: id, conn: d.Connection, recorder: SQLiteRecorder}
}

// ----- MySQL CREATE -----

// NewFieldCmdMysql is an audited command for creating fields in MySQL.
type NewFieldCmdMysql struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	params   CreateFieldParams
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c NewFieldCmdMysql) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c NewFieldCmdMysql) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c NewFieldCmdMysql) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c NewFieldCmdMysql) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c NewFieldCmdMysql) TableName() string { return "fields" }

// Params returns the parameters for this command.
func (c NewFieldCmdMysql) Params() any { return c.params }

// GetID extracts the ID from a field record.
func (c NewFieldCmdMysql) GetID(u mdbm.Fields) string { return string(u.FieldID) }

// Execute creates the field in the database.
func (c NewFieldCmdMysql) Execute(ctx context.Context, tx audited.DBTX) (mdbm.Fields, error) {
	id := c.params.FieldID
	if id.IsZero() {
		id = types.NewFieldID()
	}
	queries := mdbm.New(tx)
	params := mdbm.CreateFieldParams{
		FieldID:      id,
		ParentID:     c.params.ParentID,
		Label:        c.params.Label,
		Data:         c.params.Data,
		Validation:   c.params.Validation,
		UiConfig:     c.params.UIConfig,
		Type:         c.params.Type,
		AuthorID:     c.params.AuthorID,
		DateCreated:  c.params.DateCreated,
		DateModified: c.params.DateModified,
	}
	if err := queries.CreateField(ctx, params); err != nil {
		return mdbm.Fields{}, err
	}
	return queries.GetField(ctx, mdbm.GetFieldParams{FieldID: params.FieldID})
}

// NewFieldCmd creates a command for inserting a field.
func (d MysqlDatabase) NewFieldCmd(ctx context.Context, auditCtx audited.AuditContext, params CreateFieldParams) NewFieldCmdMysql {
	return NewFieldCmdMysql{ctx: ctx, auditCtx: auditCtx, params: params, conn: d.Connection, recorder: MysqlRecorder}
}

// ----- MySQL UPDATE -----

// UpdateFieldCmdMysql is an audited command for updating fields in MySQL.
type UpdateFieldCmdMysql struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	params   UpdateFieldParams
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c UpdateFieldCmdMysql) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c UpdateFieldCmdMysql) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c UpdateFieldCmdMysql) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c UpdateFieldCmdMysql) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c UpdateFieldCmdMysql) TableName() string { return "fields" }

// Params returns the parameters for this command.
func (c UpdateFieldCmdMysql) Params() any { return c.params }

// GetID returns the field ID for this command.
func (c UpdateFieldCmdMysql) GetID() string { return string(c.params.FieldID) }

// GetBefore retrieves the field before the update.
func (c UpdateFieldCmdMysql) GetBefore(ctx context.Context, tx audited.DBTX) (mdbm.Fields, error) {
	queries := mdbm.New(tx)
	return queries.GetField(ctx, mdbm.GetFieldParams{FieldID: c.params.FieldID})
}

// Execute updates the field in the database.
func (c UpdateFieldCmdMysql) Execute(ctx context.Context, tx audited.DBTX) error {
	queries := mdbm.New(tx)
	return queries.UpdateField(ctx, mdbm.UpdateFieldParams{
		ParentID:     c.params.ParentID,
		Label:        c.params.Label,
		Data:         c.params.Data,
		Validation:   c.params.Validation,
		UiConfig:     c.params.UIConfig,
		Type:         c.params.Type,
		AuthorID:     c.params.AuthorID,
		DateCreated:  c.params.DateCreated,
		DateModified: c.params.DateModified,
		FieldID:      c.params.FieldID,
	})
}

// UpdateFieldCmd creates a command for updating a field.
func (d MysqlDatabase) UpdateFieldCmd(ctx context.Context, auditCtx audited.AuditContext, params UpdateFieldParams) UpdateFieldCmdMysql {
	return UpdateFieldCmdMysql{ctx: ctx, auditCtx: auditCtx, params: params, conn: d.Connection, recorder: MysqlRecorder}
}

// ----- MySQL DELETE -----

// DeleteFieldCmdMysql is an audited command for deleting fields in MySQL.
type DeleteFieldCmdMysql struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	id       types.FieldID
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c DeleteFieldCmdMysql) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c DeleteFieldCmdMysql) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c DeleteFieldCmdMysql) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c DeleteFieldCmdMysql) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c DeleteFieldCmdMysql) TableName() string { return "fields" }

// GetID returns the field ID for this command.
func (c DeleteFieldCmdMysql) GetID() string { return string(c.id) }

// GetBefore retrieves the field before the delete.
func (c DeleteFieldCmdMysql) GetBefore(ctx context.Context, tx audited.DBTX) (mdbm.Fields, error) {
	queries := mdbm.New(tx)
	return queries.GetField(ctx, mdbm.GetFieldParams{FieldID: c.id})
}

// Execute deletes the field from the database.
func (c DeleteFieldCmdMysql) Execute(ctx context.Context, tx audited.DBTX) error {
	queries := mdbm.New(tx)
	return queries.DeleteField(ctx, mdbm.DeleteFieldParams{FieldID: c.id})
}

// DeleteFieldCmd creates a command for deleting a field.
func (d MysqlDatabase) DeleteFieldCmd(ctx context.Context, auditCtx audited.AuditContext, id types.FieldID) DeleteFieldCmdMysql {
	return DeleteFieldCmdMysql{ctx: ctx, auditCtx: auditCtx, id: id, conn: d.Connection, recorder: MysqlRecorder}
}

// ----- PostgreSQL CREATE -----

// NewFieldCmdPsql is an audited command for creating fields in PostgreSQL.
type NewFieldCmdPsql struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	params   CreateFieldParams
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c NewFieldCmdPsql) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c NewFieldCmdPsql) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c NewFieldCmdPsql) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c NewFieldCmdPsql) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c NewFieldCmdPsql) TableName() string { return "fields" }

// Params returns the parameters for this command.
func (c NewFieldCmdPsql) Params() any { return c.params }

// GetID extracts the ID from a field record.
func (c NewFieldCmdPsql) GetID(u mdbp.Fields) string { return string(u.FieldID) }

// Execute creates the field in the database.
func (c NewFieldCmdPsql) Execute(ctx context.Context, tx audited.DBTX) (mdbp.Fields, error) {
	id := c.params.FieldID
	if id.IsZero() {
		id = types.NewFieldID()
	}
	queries := mdbp.New(tx)
	return queries.CreateField(ctx, mdbp.CreateFieldParams{
		FieldID:      id,
		ParentID:     c.params.ParentID,
		Label:        c.params.Label,
		Data:         c.params.Data,
		Validation:   c.params.Validation,
		UiConfig:     c.params.UIConfig,
		Type:         c.params.Type,
		AuthorID:     c.params.AuthorID,
		DateCreated:  c.params.DateCreated,
		DateModified: c.params.DateModified,
	})
}

// NewFieldCmd creates a command for inserting a field.
func (d PsqlDatabase) NewFieldCmd(ctx context.Context, auditCtx audited.AuditContext, params CreateFieldParams) NewFieldCmdPsql {
	return NewFieldCmdPsql{ctx: ctx, auditCtx: auditCtx, params: params, conn: d.Connection, recorder: PsqlRecorder}
}

// ----- PostgreSQL UPDATE -----

// UpdateFieldCmdPsql is an audited command for updating fields in PostgreSQL.
type UpdateFieldCmdPsql struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	params   UpdateFieldParams
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c UpdateFieldCmdPsql) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c UpdateFieldCmdPsql) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c UpdateFieldCmdPsql) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c UpdateFieldCmdPsql) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c UpdateFieldCmdPsql) TableName() string { return "fields" }

// Params returns the parameters for this command.
func (c UpdateFieldCmdPsql) Params() any { return c.params }

// GetID returns the field ID for this command.
func (c UpdateFieldCmdPsql) GetID() string { return string(c.params.FieldID) }

// GetBefore retrieves the field before the update.
func (c UpdateFieldCmdPsql) GetBefore(ctx context.Context, tx audited.DBTX) (mdbp.Fields, error) {
	queries := mdbp.New(tx)
	return queries.GetField(ctx, mdbp.GetFieldParams{FieldID: c.params.FieldID})
}

// Execute updates the field in the database.
func (c UpdateFieldCmdPsql) Execute(ctx context.Context, tx audited.DBTX) error {
	queries := mdbp.New(tx)
	return queries.UpdateField(ctx, mdbp.UpdateFieldParams{
		ParentID:     c.params.ParentID,
		Label:        c.params.Label,
		Data:         c.params.Data,
		Validation:   c.params.Validation,
		UiConfig:     c.params.UIConfig,
		Type:         c.params.Type,
		AuthorID:     c.params.AuthorID,
		DateCreated:  c.params.DateCreated,
		DateModified: c.params.DateModified,
		FieldID:      c.params.FieldID,
	})
}

// UpdateFieldCmd creates a command for updating a field.
func (d PsqlDatabase) UpdateFieldCmd(ctx context.Context, auditCtx audited.AuditContext, params UpdateFieldParams) UpdateFieldCmdPsql {
	return UpdateFieldCmdPsql{ctx: ctx, auditCtx: auditCtx, params: params, conn: d.Connection, recorder: PsqlRecorder}
}

// ----- PostgreSQL DELETE -----

// DeleteFieldCmdPsql is an audited command for deleting fields in PostgreSQL.
type DeleteFieldCmdPsql struct {
	ctx      context.Context
	auditCtx audited.AuditContext
	id       types.FieldID
	conn     *sql.DB
	recorder audited.ChangeEventRecorder
}

// Context returns the command context.
func (c DeleteFieldCmdPsql) Context() context.Context { return c.ctx }

// AuditContext returns the audit context.
func (c DeleteFieldCmdPsql) AuditContext() audited.AuditContext { return c.auditCtx }

// Connection returns the database connection.
func (c DeleteFieldCmdPsql) Connection() *sql.DB { return c.conn }

// Recorder returns the change event recorder.
func (c DeleteFieldCmdPsql) Recorder() audited.ChangeEventRecorder { return c.recorder }

// TableName returns the table name for this command.
func (c DeleteFieldCmdPsql) TableName() string { return "fields" }

// GetID returns the field ID for this command.
func (c DeleteFieldCmdPsql) GetID() string { return string(c.id) }

// GetBefore retrieves the field before the delete.
func (c DeleteFieldCmdPsql) GetBefore(ctx context.Context, tx audited.DBTX) (mdbp.Fields, error) {
	queries := mdbp.New(tx)
	return queries.GetField(ctx, mdbp.GetFieldParams{FieldID: c.id})
}

// Execute deletes the field from the database.
func (c DeleteFieldCmdPsql) Execute(ctx context.Context, tx audited.DBTX) error {
	queries := mdbp.New(tx)
	return queries.DeleteField(ctx, mdbp.DeleteFieldParams{FieldID: c.id})
}

// DeleteFieldCmd creates a command for deleting a field.
func (d PsqlDatabase) DeleteFieldCmd(ctx context.Context, auditCtx audited.AuditContext, id types.FieldID) DeleteFieldCmdPsql {
	return DeleteFieldCmdPsql{ctx: ctx, auditCtx: auditCtx, id: id, conn: d.Connection, recorder: PsqlRecorder}
}
