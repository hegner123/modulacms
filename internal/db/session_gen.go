// Code generated by tools/dbgen; DO NOT EDIT.
package db

import (
	"database/sql"
	"fmt"

	mdbm "github.com/hegner123/modulacms/internal/db-mysql"
	mdbp "github.com/hegner123/modulacms/internal/db-psql"
	mdb "github.com/hegner123/modulacms/internal/db-sqlite"
	"github.com/hegner123/modulacms/internal/db/types"
)

///////////////////////////////
// STRUCTS
//////////////////////////////

// Sessions represents a session record in the database.
type Sessions struct {
	SessionID   types.SessionID      `json:"session_id"`
	UserID      types.NullableUserID `json:"user_id"`
	CreatedAt   types.Timestamp      `json:"created_at"`
	ExpiresAt   types.Timestamp      `json:"expires_at"`
	LastAccess  sql.NullString       `json:"last_access"`
	IpAddress   sql.NullString       `json:"ip_address"`
	UserAgent   sql.NullString       `json:"user_agent"`
	SessionData sql.NullString       `json:"session_data"`
}

// CreateSessionParams contains parameters for creating a new session.
type CreateSessionParams struct {
	UserID      types.NullableUserID `json:"user_id"`
	CreatedAt   types.Timestamp      `json:"created_at"`
	ExpiresAt   types.Timestamp      `json:"expires_at"`
	LastAccess  sql.NullString       `json:"last_access"`
	IpAddress   sql.NullString       `json:"ip_address"`
	UserAgent   sql.NullString       `json:"user_agent"`
	SessionData sql.NullString       `json:"session_data"`
}

// UpdateSessionParams contains parameters for updating an existing session.
type UpdateSessionParams struct {
	UserID      types.NullableUserID `json:"user_id"`
	CreatedAt   types.Timestamp      `json:"created_at"`
	ExpiresAt   types.Timestamp      `json:"expires_at"`
	LastAccess  sql.NullString       `json:"last_access"`
	IpAddress   sql.NullString       `json:"ip_address"`
	UserAgent   sql.NullString       `json:"user_agent"`
	SessionData sql.NullString       `json:"session_data"`
	SessionID   types.SessionID      `json:"session_id"`
}

// MapStringSession converts Sessions to StringSessions for TUI display.
func MapStringSession(a Sessions) StringSessions {
	return StringSessions{
		SessionID:   a.SessionID.String(),
		UserID:      a.UserID.String(),
		CreatedAt:   a.CreatedAt.String(),
		ExpiresAt:   a.ExpiresAt.String(),
		LastAccess:  NullStringToEmpty(a.LastAccess),
		IpAddress:   NullStringToEmpty(a.IpAddress),
		UserAgent:   NullStringToEmpty(a.UserAgent),
		SessionData: NullStringToEmpty(a.SessionData),
	}
}

///////////////////////////////
// SQLITE
//////////////////////////////

// QUERIES

// CountSessions returns the total number of sessions in the database.
func (d Database) CountSessions() (*int64, error) {
	queries := mdb.New(d.Connection)
	c, err := queries.CountSession(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreateSessionTable creates the sessions table in the database.
func (d Database) CreateSessionTable() error {
	queries := mdb.New(d.Connection)
	err := queries.CreateSessionTable(d.Context)
	return err
}

// GetSession retrieves a session by ID.
func (d Database) GetSession(id types.SessionID) (*Sessions, error) {
	queries := mdb.New(d.Connection)
	row, err := queries.GetSession(d.Context, mdb.GetSessionParams{SessionID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapSession(row)
	return &res, nil
}

// ListSessions retrieves all sessions in the database.
func (d Database) ListSessions() (*[]Sessions, error) {
	queries := mdb.New(d.Connection)
	rows, err := queries.ListSession(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Sessions: %v\n", err)
	}
	res := []Sessions{}
	for _, v := range rows {
		m := d.MapSession(v)
		res = append(res, m)
	}
	return &res, nil
}

// GetSessionByUserId retrieves a session by userID.
func (d Database) GetSessionByUserId(userID types.NullableUserID) (*Sessions, error) {
	queries := mdb.New(d.Connection)
	row, err := queries.GetSessionByUserId(d.Context, mdb.GetSessionByUserIdParams{UserID: userID})
	if err != nil {
		return nil, err
	}
	res := d.MapSession(row)
	return &res, nil
}

///////////////////////////////
// MYSQL
//////////////////////////////

// QUERIES

// CountSessions returns the total number of sessions in the database.
func (d MysqlDatabase) CountSessions() (*int64, error) {
	queries := mdbm.New(d.Connection)
	c, err := queries.CountSession(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreateSessionTable creates the sessions table in the database.
func (d MysqlDatabase) CreateSessionTable() error {
	queries := mdbm.New(d.Connection)
	err := queries.CreateSessionTable(d.Context)
	return err
}

// GetSession retrieves a session by ID.
func (d MysqlDatabase) GetSession(id types.SessionID) (*Sessions, error) {
	queries := mdbm.New(d.Connection)
	row, err := queries.GetSession(d.Context, mdbm.GetSessionParams{SessionID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapSession(row)
	return &res, nil
}

// ListSessions retrieves all sessions in the database.
func (d MysqlDatabase) ListSessions() (*[]Sessions, error) {
	queries := mdbm.New(d.Connection)
	rows, err := queries.ListSession(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Sessions: %v\n", err)
	}
	res := []Sessions{}
	for _, v := range rows {
		m := d.MapSession(v)
		res = append(res, m)
	}
	return &res, nil
}

// GetSessionByUserId retrieves a session by userID.
func (d MysqlDatabase) GetSessionByUserId(userID types.NullableUserID) (*Sessions, error) {
	queries := mdbm.New(d.Connection)
	row, err := queries.GetSessionByUserId(d.Context, mdbm.GetSessionByUserIdParams{UserID: userID})
	if err != nil {
		return nil, err
	}
	res := d.MapSession(row)
	return &res, nil
}

///////////////////////////////
// POSTGRES
//////////////////////////////

// QUERIES

// CountSessions returns the total number of sessions in the database.
func (d PsqlDatabase) CountSessions() (*int64, error) {
	queries := mdbp.New(d.Connection)
	c, err := queries.CountSession(d.Context)
	if err != nil {
		return nil, fmt.Errorf("%v", err)
	}
	return &c, nil
}

// CreateSessionTable creates the sessions table in the database.
func (d PsqlDatabase) CreateSessionTable() error {
	queries := mdbp.New(d.Connection)
	err := queries.CreateSessionTable(d.Context)
	return err
}

// GetSession retrieves a session by ID.
func (d PsqlDatabase) GetSession(id types.SessionID) (*Sessions, error) {
	queries := mdbp.New(d.Connection)
	row, err := queries.GetSession(d.Context, mdbp.GetSessionParams{SessionID: id})
	if err != nil {
		return nil, err
	}
	res := d.MapSession(row)
	return &res, nil
}

// ListSessions retrieves all sessions in the database.
func (d PsqlDatabase) ListSessions() (*[]Sessions, error) {
	queries := mdbp.New(d.Connection)
	rows, err := queries.ListSession(d.Context)
	if err != nil {
		return nil, fmt.Errorf("failed to get Sessions: %v\n", err)
	}
	res := []Sessions{}
	for _, v := range rows {
		m := d.MapSession(v)
		res = append(res, m)
	}
	return &res, nil
}

// GetSessionByUserId retrieves a session by userID.
func (d PsqlDatabase) GetSessionByUserId(userID types.NullableUserID) (*Sessions, error) {
	queries := mdbp.New(d.Connection)
	row, err := queries.GetSessionByUserId(d.Context, mdbp.GetSessionByUserIdParams{UserID: userID})
	if err != nil {
		return nil, err
	}
	res := d.MapSession(row)
	return &res, nil
}
